<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Risk Reward Report, by Blotter.fyi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>

    <style>
        @font-face {
            font-family: 'Basier Square';
            src: url('../html/font/basier-square-regular.otf') format('opentype');
            font-weight: normal;
            font-style: normal;
        }
        @font-face {
            font-family: 'Basier Square';
            src: url('../html/font/basier-square-semi-bold.otf') format('opentype');
            font-weight: bold;
            font-style: normal;
        }
        body {
            font-family: 'Basier Square', sans-serif;

            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        
        }

        .text-success{
            color: #008bba  
        }

        #chart-container {
            width: 320px;
            height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            
            
        }
        
    </style>


</head>
<body class="bg-[#daeaea] p-8 px-10 items-center justify-center flex w-full h-full">
    <div class="max-w-[1280px] mx-auto bg-white p-8 rounded-2xl shadow-sm shadow-black/10">
        <div class="flex items-start">
            <img src="https://blotter.fyi/static/logos/{{ticker}}.png" class="w-14 h-14 mr-4 rounded-full">
            <div class="flex flex-col">
                <h1 class="text-3xl font-bold text-success">{{ticker}} : Risk Reward</h1>
        
                <p class="text-lg text-neutral-900 mb-6 ">{{heading}}</p>
            </div>
            
        </div>
        

        <div class="grid grid-cols-10 gap-16">
            <div class="col-span-6">
                <h2 class="text-xl font-semibold mb-2 ">Price Target ${{base_price_target}}</h2>
                <p class="text-base mb-4 ">{{heading_case}}</p>
                
                <div class="flex flex-row gap-x-6 justify-between pr-4 mb-4">
                <h3 class="text-lg font-semibold mb-2 mt-4 ">Price Target Distribution</h3>
                <div class="w-full max-w-sm bg-white rounded-lg  mt-4">
                    <div class="relative h-3 bg-neutral-200 rounded-md">
                        <div id="ms-bar" class="absolute h-full  rounded-full"></div>
                        <div id="mean-marker" class="absolute w-4 h-4 bg-[#008BBA] rounded-0 top-1/2 -translate-y-1/2 transform rotate-45"></div>
                        <div id="mean-target-text" class="absolute -bottom-8 transform -translate-x-1/2 text-base">${{mean_target}}</div>
                        <div id="now-marker" class="absolute w-4 h-4 bg-neutral-600 rounded-0 top-1/2 -translate-y-1/2 transform rotate-45"></div>
                        
                    </div>
                    <div class="flex justify-between mt-2 text-base">
                        <span>${{low_target}}</span>
                        <span>${{high_target}}</span>
                    </div>
                    
                </div>
            </div>
               

                <div class="flex flex-col w-full  border-t border-neutral-300 pt-8 pb-4">
                <h2 class="text-xl font-semibold mb-2 mt-0">AI Targets</h2>


                
                <canvas id="priceChart" width="800" height="320" ></canvas>
                <p class="text-xs text-neutral-500 mb-2 mt-6">AI targets are generated by having a large number of AI models vote for a price target based on a plethora of fundamental and technical data about the stock.These models try to mimic how a real analyst would value a stock. </p>
                </div>



                    <div class="flex flex-row w-full justify-between border-t border-neutral-300 pt-8">

                        <div class="flex flex-col">
                        <h3 class="text-lg font-semibold  mb-2 ">Risk Reward Themes</h3>
                    <div class="flex gap-y-2 flex-col">
                        <div class="flex flex-row gap-x-4">
                            <h4 class="text-base font-semibold ">{{theme_1}}</h4>
                            <p class="text-base ">{{theme_1_sentiment}}</p>
                        </div>
                        <div class="flex flex-row gap-x-4">
                            <h4 class="text-base font-semibold ">{{theme_2}}</h4>
                            <p class="text-base ">{{theme_2_sentiment}}</p>
                        </div>
                        <div class="flex flex-row gap-x-4">
                            <h4 class="text-base font-semibold ">{{theme_3}}</h4>
                            <p class="text-base ">{{theme_3_sentiment}}</p>
                        </div>
                    </div>
                </div>


                        <div class="flex flex-col">
                        <h3 class="text-lg font-semibold mb-2 ">Consensus Rating Distribution</h3>
                        <div class="space-y-2">
                            <div class="flex items-center  gap-x-4">
                                <div class="w-[130px]">Overweight</div>
                                <div class="w-48 bg-neutral-200 h-4">
                                    <div class="bg-[#72ba00] h-full" style="width: {{overweight}}%;"></div>
                                </div>
                                <span class="ml-2">{{overweight}}%</span>
                            </div>
                            <div class="flex items-center  gap-x-4">
                                <div class="w-[130px]">Equal-Weight</div>
                                <div class="w-48 bg-neutral-200 h-4">
                                    <div class="bg-[#008bba] h-full" style="width: {{equal_weight}}%;"></div>
                                </div>
                                <span class="ml-2">{{equal_weight}}%</span>
                            </div>
                            <div class="flex items-center  gap-x-4">
                                <div class="w-[130px]">Underweight</div>
                                <div class="w-48 bg-neutral-200 h-4">
                                    <div class="bg-[#d82f2f] h-full" style="width: {{underweight}}%;"></div>
                                </div>
                                <span class="ml-2">{{underweight}}%</span>
                            </div>
                        </div>
                    </div>


                    </div>
                    
                    

            </div>

            <div class="col-span-4 ">

                <div class="w-full relative flex flex-col items-center" style="background-color: #f0f0f0; border-radius: 20px; padding: 10px; margin-top:  -90px">
                    <h3 class="text-xl font-semibold  absolute left-6 top-4">AI Ratings</h3>
                <div id="chart-container" style="">
                    
                    <canvas id="radarChart"></canvas>
                </div>
            </div>

                <h2 class="text-xl font-semibold mb-4 mt-8 border-t border-neutral-300 pt-8">{{analyst_rating}} Thesis</h2>
                <ul class="list-disc pl-5 space-y-2 text-base ">
                    <li>{{thesis_one}}</li>
                    <li>{{thesis_two}}</li>
                    <li>{{thesis_three}}</li>
                </ul>

                

               

            </div>
        </div>


        <div class="grid grid-cols-3 gap-8 mt-8 border-t border-neutral-300 pt-6">
            <div>
                <h3 class="text-xl font-semibold mb-2 ">Bull Case ${{bull_price_target}}</h3>
                <p class="text-base ">{{bull_thesis}}</p>
            </div>
            <div>
                <h3 class="text-xl font-semibold mb-2 ">Base Case ${{base_price_target}}</h3>
                <p class="text-base ">{{base_thesis}}</p>
            </div>
            <div>
                <h3 class="text-xl font-semibold mb-2 ">Bear Case ${{bear_price_target}}</h3>
                <p class="text-base ">{{bear_thesis}}</p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var low = {{low_target}};
            var mean = {{mean_target}};
            var high = {{high_target}};
            var current = {{current_price}};
            var range = high - low;
            var meanPosition = ((mean - low) / range) * 100;
            document.getElementById('mean-marker').style.left = meanPosition + '%';
            document.getElementById('ms-bar').style.width = meanPosition + '%';
            document.getElementById('mean-target-text').style.left = meanPosition + '%';
            var currentPosition = ((current - low) / range) * 100;
            document.getElementById('now-marker').style.left = currentPosition + '%';
            document.getElementById('now-target-text').style.left = currentPosition + '%';
        });

        // Sample data (replace with your actual data)
        const price_chart = JSON.parse('{{chart}}');
        const radar = JSON.parse('{{radar}}');
        price_chart.reverse();
        
        const maxTargetRaw = parseFloat('{{high_target_raw}}');
        const avgTarget = parseFloat('{{mean_target}}');
        const minTargetRaw = parseFloat('{{low_target_raw}}');

        // Prepare data for Chart.js
        const labels = price_chart.map(item => new Date(item.date));
        const closePrices = price_chart.map(item => item.close);

        // Add cone data points
        const lastDate = new Date(price_chart[price_chart.length - 1].date);
        const coneDate = new Date(lastDate.setMonth(lastDate.getMonth() + 6));
        labels.push(coneDate);

        const ctx = document.getElementById('priceChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                {
                    label: 'Target Range',
                    data: [...Array(closePrices.length - 1).fill(null), closePrices[closePrices.length - 1], maxTargetRaw],
                    borderColor: 'rgba(0, 0, 0, 0)',
                    backgroundColor: 'rgba(173, 216, 230, 0.4)',
                    fill: 1,
                    pointRadius: 0
                },
                {
                    label: 'Min Target',
                    data: [...Array(closePrices.length - 1).fill(null), closePrices[closePrices.length - 1], minTargetRaw],
                    borderColor: '#e03134',
                    borderWidth: 3,
                    pointRadius: 0,
                    fill: false
                }, {
                    label: 'Max Target',
                    data: [...Array(closePrices.length - 1).fill(null), closePrices[closePrices.length - 1], maxTargetRaw],
                    borderColor: '#85bf00',
                    borderWidth: 3,
                    pointRadius: 0,
                    fill: false
                }, {
                    label: 'Avg Target',
                    data: [...Array(closePrices.length - 1).fill(null), closePrices[closePrices.length - 1], avgTarget],
                    borderColor: '#212121',
                    borderWidth: 3,
                    pointRadius: 0,
                    fill: false
                },
                {
                    label: 'Close Price',
                    data: closePrices,
                    borderColor: '#008BBA',
                    borderWidth: 3,
                    fill: false,
                    pointRadius: 0,
                    tension: 0.4
                }, 
                ]
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        type: 'time',
                        time: {
                            unit: 'month',
                            displayFormats: {
                                month: 'MMM yyyy'
                            }
                        },
                        grid: {
                            display: false,
                            drawOnChartArea: true
                        }
                    },
                    y: {
                        position: 'right',
                        beginAtZero: false,
                        grid: {
                            display: false,
                            drawOnChartArea: true
                        }
                    }
                },
                plugins: {
                    legend: {
                        position: 'top',
                        display: false
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false
                    }
                }
            }
        });


        // Prepare data for Chart.js
        const chartData = {
            labels: Object.keys(radar),
            datasets: [{
                data: Object.values(radar),
                backgroundColor: 'rgba(0, 139, 186, 0.5)',
                borderColor: 'rgba(0, 139, 186, 1)',
                borderWidth: 3,
                pointBackgroundColor: 'rgba(0, 139, 186, 1)',
                pointBorderColor: 'rgba(0, 139, 186, 1)',
                pointHoverBackgroundColor: '#fff',
                pointHoverBorderColor: 'rgba(0, 139, 186, 1)'
            }]
        };

        // Chart configuration
        const config = {
            type: 'radar',
            data: chartData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    r: {
                        angleLines: {
                            color: 'rgba(0, 0, 0, 0.05)',
                            lineWidth: 2
                        },
                        grid: {
                            color: 'rgba(0, 0,0, 0.05)',
                            circular: true,
                            lineWidth: 2
                        },
                        pointLabels: {
                            color: 'rgba(0, 0, 0, 0.8)',
                            font: {
                                size: 14
                            }
                        },
                        ticks: {
                            display: false,
                            beginAtZero: false,
                            min: 1,
                            max: 5,
                            stepSize: 1,
                            count: 5  // This creates 5 steps (1 to 5)
                        },
                        suggestedMin: 1,
                        suggestedMax: 5
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        };

        // Create the chart
        const ctx_radar = document.getElementById('radarChart').getContext('2d');
        new Chart(ctx_radar, config);

    </script>
</body>
</html>